<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Website to evaluate Visual Regression Tools</title>
  <link rel="stylesheet" href="public/output.css">
  <link rel="icon" href="favicon.ico">
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,600|Fira+Mono:400,500,700|Merriweather:400,700|Roboto:400,500,700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { font-family: 'Montserrat', sans-serif; }
    .font-mono { font-family: 'Fira Mono', monospace; }
    .font-serif { font-family: 'Merriweather', serif; }
    .side-panel-open { right: 0 !important; }
    .side-panel-closed { right: -400px !important; }
    .transition-right { transition: right 0.35s cubic-bezier(.4,2,.6,1); }
    .tab-active { background: #4B1FA6; color: #fff; font-weight: 800; border-bottom: 2px solid #fff; transform: scale(1.06); z-index: 2; }
    .tab-inactive { background: #ece6fa; color: #666; }
    .sysval { margin-left:3px; color:#666; font-size:0.95em; font-weight:400; }
    .sysinfo-row { margin-bottom: 12px; }
    .sysinfo-hr { border: none; border-top: 1px solid #ececec; margin: 0 0 8px 0; width: 90%; }
    @keyframes marquee {
      0% { transform: translateX(100vw); }
      100% { transform: translateX(-100vw); }
    }
    .animate-marquee { animation: marquee 30s linear infinite; }
    @keyframes marquee {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes fadeOut {
      to { opacity: 0; }
    }
    .invert, [filter~="invert(1)"] {
      filter: invert(1) hue-rotate(180deg) !important;
    }
    .dark {
      background: #18181b !important;
      color: #f3f4f6 !important;
    }
    .dark input, .dark select, .dark textarea {
      background: #27272a !important;
      color: #f3f4f6 !important;
    }
    .dark .bg-white { background: #27272a !important; }
    .dark .text-black { color: #f3f4f6 !important; }
    .dark .shadow-2xl { box-shadow: 0 8px 32px 0 rgba(0,0,0,0.8) !important; }
    @media (max-width: 900px) {
      .login-card, .flex.max-w-4xl {
        flex-direction: column !important;
        min-height: 0 !important;
        height: auto !important;
      }
      #login-right, .flex-1.bg-gradient-to-br {
        min-width: 0 !important;
        height: 220px !important;
        min-height: 220px !important;
        border-radius: 0 0 24px 24px !important;
      }
      #slider-img {
        border-radius: 0 0 24px 24px !important;
        height: 100% !important;
        min-height: 220px !important;
        width: 100% !important;
        object-fit: cover !important;
      }
    }
    @media (max-width: 600px), (max-height: 600px) {
      .flex.max-w-4xl {
        min-height: unset !important;
        height: auto !important;
        display: block !important;
        border-radius: 0 !important;
        box-shadow: none !important;
      }
      #login-right, .flex-1.bg-gradient-to-br {
        display: none !important;
      }
    }
    @media (max-width: 600px) and (orientation: portrait) {
      #login-right, .flex-1.bg-gradient-to-br {
        display: none !important;
      }
    }
    @media (max-width: 900px) and (orientation: portrait) {
      #login-right, .flex-1.bg-gradient-to-br {
        display: none !important;
      }
    }
    @media (max-width: 1024px) and (orientation: portrait) {
      #login-right, .flex-1.bg-gradient-to-br {
        display: none !important;
      }
    }
    html, body {
      overflow-x: hidden;
      overflow-y: auto;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    /* Orientation-specific styles */
    @media (orientation: portrait) {
      #main-card {
        flex-direction: column !important;
        min-height: 0 !important;
        height: auto !important;
        max-width: 98vw !important;
        margin-top: 2vw !important;
      }
      #login-right, .flex-1.bg-gradient-to-br {
        min-width: 0 !important;
        height: 180px !important;
        min-height: 180px !important;
        border-radius: 0 0 24px 24px !important;
      }
      #slider-img {
        border-radius: 0 0 24px 24px !important;
        height: 100% !important;
        min-height: 180px !important;
        width: 100% !important;
        object-fit: cover !important;
      }
    }
    @media (orientation: landscape) {
      #main-card {
        flex-direction: row !important;
        min-height: 320px !important;
        max-width: 80vw !important;
        margin-top: 3vw !important;
      }
      #login-right, .flex-1.bg-gradient-to-br {
        min-width: 220px !important;
        height: auto !important;
        border-radius: 0 24px 24px 0 !important;
      }
      #slider-img {
        border-radius: 0 24px 24px 0 !important;
        height: 100% !important;
        min-height: 220px !important;
        width: 100% !important;
        object-fit: cover !important;
      }
    }
    /* --- Responsive Breakpoints --- */
    /* Mobile: up to 600px */
    @media (max-width: 600px) { /* ...existing mobile rules... */ }
    /* Tablet: up to 900px */
    @media (max-width: 900px) { /* ...existing tablet rules... */ }
    /* Desktop: above 900px */
    /* Default layout applies */
    .high-contrast-img { filter: contrast(2) brightness(1.2) !important; }
    .distorted-img { filter: none !important; }
  </style>
</head>
<body class="bg-purple-100 min-h-screen flex flex-col justify-center items-center">
  <div id="static-banner" style="display:none;" class="fixed top-0 left-0 w-full bg-purple-700 text-gray-100 text-center py-3 px-4 font-semibold text-base shadow-xl z-[3000]" role="alert">
    <span class="font-bold">Reminder:</span> Visual regression detects unintended UI changes between software versions.
  </div>
  <!-- Main Header -->
  <header class="py-4 px-6 flex justify-center items-center z-[200]">
    <h1 class="text-2xl md:text-3xl font-extrabold text-purple-700 text-center tracking-tight">Visual Regression - Evaluator</h1>
  </header>
  <!-- Decorative Background Lines/Curves -->
  <svg class="background-lines pointer-events-none fixed top-0 left-0 w-full h-full z-[-10]" width="100%" height="100%" viewBox="0 0 1440 900" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M0,200 Q400,400 900,100 Q1200,0 1440,200" stroke="#d1b3ff" stroke-width="3" fill="none"/>
    <path d="M0,700 Q600,900 1440,600" stroke="#d1b3ff" stroke-width="2" fill="none"/>
  </svg>
  <!-- Login Card -->
  <div id="main-card" class="flex w-full max-w-4xl rounded-3xl bg-white overflow-hidden mt-8 items-stretch min-h-[320px] h-auto md:h-[420px] lg:h-[480px] xl:h-[520px] z-[100]">
    <!-- Login Left -->
    <div class="flex-1 p-8 flex flex-col justify-center h-full min-w-[420px] md:min-w-[480px]">
      <div class="flex items-center mb-2 justify-between">
        <span class="inline-block w-8 h-4 bg-purple-200 rounded-full mr-2"></span>
        <h2 class="text-2xl font-bold" id="login-heading">Log In</h2>
        <div id="header-btn-group" class="flex gap-2 mb-2 transition-all duration-300">
          <button class="flex items-center justify-center w-8 h-8 rounded-full text-purple-400 text-lg shadow cursor-pointer hover:bg-purple-100 transition" id="open-side-panel-btn" title="Info"><i class="fa-solid fa-info"></i></button>
          <button id="lang-icon" class="flex items-center justify-center w-8 h-8 rounded-full text-purple-400 text-lg shadow cursor-pointer hover:bg-purple-100 transition" title="Switch Language"><i class="fa-solid fa-globe"></i></button>
          <button id="help-icon" class="flex items-center justify-center w-8 h-8 rounded-full text-purple-400 text-lg shadow cursor-pointer hover:bg-purple-100 transition" title="Settings"><i class="fa-solid fa-cog"></i></button>
        </div>
      </div>
        <p class="text-gray-400 mb-6" id="login-subtitle">Welcome back! Please enter your details</p>
        <form class="space-y-3" id="login-form" autocomplete="off">
          <div id="login-fields">
          <div class="mb-2 relative">
              <label class="block mb-1 font-medium" for="email">Email</label>
              <input class="w-full px-3 py-2 border rounded-md" type="email" id="email" name="email" placeholder="Enter your email" required>
            </div>
          <div class="mb-2 relative">
              <label class="block mb-1 font-medium" for="password">Password</label>
            <input class="w-full px-3 py-2 border rounded-md pr-10" type="password" id="password" name="password" placeholder="Enter your password" required>
            <span class="absolute right-3 top-9 text-gray-400 cursor-pointer text-lg" onclick="togglePassword()"><i class="fa-regular fa-eye" id="eyeIcon"></i></span>
            </div>
            <a href="#" class="text-purple-500 text-sm mb-2 inline-block" id="forgot-link">forgot password?</a>
            <button type="submit" id="login-btn" class="w-full py-2 bg-purple-500 text-white rounded-md font-semibold hover:bg-purple-600 transition mb-2" disabled>Log in</button>
            <div class="grid grid-cols-3 gap-2 mb-2 w-full mx-auto" style="grid-template-columns: repeat(3, 1fr);">
              <button type="button" class="border rounded-md py-2 w-32 mx-auto flex items-center justify-center gap-2 text-red-500 text-sm"><i class="fab fa-google"></i> Google</button>
              <button type="button" class="border rounded-md py-2 w-32 mx-auto flex items-center justify-center gap-2 text-blue-600 text-sm"><i class="fab fa-facebook-f"></i> Facebook</button>
              <button type="button" class="border rounded-md py-2 w-32 mx-auto flex items-center justify-center gap-2 text-black text-sm"><i class="fab fa-apple"></i> Apple</button>
              <button type="button" class="border rounded-md py-2 w-32 mx-auto flex items-center justify-center gap-2 text-blue-700 text-sm"><i class="fab fa-linkedin-in"></i> LinkedIn</button>
              <button type="button" class="border rounded-md py-2 w-32 mx-auto flex items-center justify-center gap-2 text-blue-800 text-sm"><i class="fab fa-microsoft"></i> Microsoft</button>
              <button type="button" class="border rounded-md py-2 w-32 mx-auto flex items-center justify-center gap-2 text-sky-400 text-sm"><i class="fab fa-twitter"></i> Twitter</button>
            </div>
          </div>
          <div id="forgot-fields" style="display:none;">
            <div class="mb-2">
              <label class="block mb-1 font-medium" for="forgot-email">Email</label>
              <input class="w-full px-3 py-2 border rounded-md" type="email" id="forgot-email" name="forgot-email" placeholder="Enter your email" required>
            </div>
            <button type="submit" class="w-full py-2 bg-purple-500 text-white rounded-md font-semibold hover:bg-purple-600 transition mb-2">Send Reset Link</button>
            <a href="#" class="text-purple-500 text-sm mb-2 inline-block" id="back-to-login">Back to Login</a>
          </div>
          <div id="signup-fields" style="display:none;">
            <div class="mb-2">
              <label class="block mb-1 font-medium" for="signup-name">Name</label>
              <input class="w-full px-3 py-2 border rounded-md" type="text" id="signup-name" name="signup-name" placeholder="Enter your name" required>
            </div>
            <div class="mb-2">
              <label class="block mb-1 font-medium" for="signup-email">Email</label>
              <input class="w-full px-3 py-2 border rounded-md" type="email" id="signup-email" name="signup-email" placeholder="Enter your email" required>
            </div>
            <div class="mb-2">
              <label class="block mb-1 font-medium" for="signup-password">Password</label>
              <input class="w-full px-3 py-2 border rounded-md" type="password" id="signup-password" name="signup-password" placeholder="Enter your password" required>
            </div>
            <div class="mb-2">
              <label class="block mb-1 font-medium" for="signup-confirm">Confirm Password</label>
              <input class="w-full px-3 py-2 border rounded-md" type="password" id="signup-confirm" name="signup-confirm" placeholder="Confirm your password" required>
            </div>
            <button type="submit" id="signup-btn" class="w-full py-2 bg-purple-500 text-white rounded-md font-semibold hover:bg-purple-600 transition mb-2" disabled>Sign Up</button>
            <a href="#" class="text-purple-500 text-sm mb-2 inline-block" id="back-to-login-signup">Back to Login</a>
          </div>
        </form>
        <div class="text-center text-gray-400 mt-4" id="signup-link-row">Don't have account?<a href="#" class="text-purple-500 ml-1" id="show-signup">Sign Up</a></div>
        <div id="countdown-timer" class="hidden text-center mt-2 text-purple-500 font-semibold"></div>
      </div>
    <!-- Login Right -->
    <div id="login-right" class="flex-1 bg-gradient-to-br from-purple-200 to-purple-400 flex items-stretch justify-center relative min-w-[220px] h-full">
        <img id="slider-img" class="w-full h-full object-cover rounded-r-3xl" src="https://images.unsplash.com/photo-1513258496099-48168024aec0?auto=format&fit=crop&w=540&q=80" alt="Login Visual" />
      <div id="slider-dots" class="absolute left-1/2 bottom-4 transform -translate-x-1/2 flex gap-2 bg-black bg-opacity-10 px-4 py-1 rounded-xl"></div>
    </div>
  </div>
  <!-- System Info Side Panel -->
  <div id="side-panel" class="fixed top-0 left-[-400px] w-[340px] h-full bg-white shadow-lg z-50 transition-right flex flex-col rounded-r-2xl">
    <button id="side-panel-close" class="absolute top-3 left-4 text-2xl text-purple-500">&times;</button>
    <div class="p-0 pt-10 overflow-y-auto flex-1">
      <div class="font-bold text-lg mb-2 px-6">System Info</div>
      <div id="side-panel-content" class="text-xs text-gray-700 px-6 py-4">
        <!-- Dynamic system info will be injected here -->
      </div>
    </div>
  </div>
  <!-- Visual Regression Parameters Right Panel -->
  <div id="help-panel" class="fixed top-0 right-[-400px] w-[400px] h-full bg-white shadow-lg z-50 transition-right flex flex-col rounded-l-2xl">
      <button id="help-close" class="absolute top-3 right-4 text-2xl text-purple-500">&times;</button>
    <div class="p-0 pt-10 overflow-y-auto flex-1">
      <div class="font-bold text-lg mb-2 px-6">Visual Regression Parameters</div>
      <div id="param-tabs" class="flex gap-1 mb-4 px-6"></div>
      <div id="param-form" class="grid grid-cols-1 gap-4 mb-4 px-6"></div>
      <div class="flex gap-3 justify-end px-6 pb-6">
        <button id="param-reset" type="button" class="bg-purple-100 text-purple-600 rounded-md px-5 py-2 font-bold">Reset</button>
        </div>
            </div>
            </div>
  <!-- Popup Modal -->
  <div id="popup-modal" class="hidden fixed top-0 left-0 w-full h-full bg-black bg-opacity-45 z-[3000] flex items-center justify-center">
    <div class="bg-white p-8 rounded-2xl shadow-2xl w-[60vw] max-w-[400px] text-center relative flex flex-col items-center border border-gray-200 dark:border-gray-700">
      <button id="popup-close" class="absolute top-3 right-4 text-2xl text-purple-500 hover:text-purple-700 transition">&times;</button>
      <div class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-2 flex items-center gap-2"><i class="fa-solid fa-circle-info text-purple-500"></i> Visual Regression Modal</div>
      <div class="mb-4 text-gray-600 dark:text-gray-300">This is a realistic popup/modal. You triggered this by adding <b>popup=on</b> to the URL or toggling Visual Regression Parameters.<br><br>Popups are useful for onboarding, warnings, confirmations, and more. You can style and animate them as needed.</div>
      <button id="popup-action" class="mt-2 px-5 py-2 bg-purple-500 text-white rounded-lg font-semibold shadow hover:bg-purple-600 transition">Got it!</button>
            </div>
          </div>
  <!-- Cookie Banner -->
  <div id="cookie-banner" class="hidden fixed left-1/2 bottom-8 bg-yellow-100 text-gray-900 shadow-xl px-8 py-6 flex items-start justify-between z-[1000] text-base rounded-xl border-2 border-yellow-400 min-w-[320px] max-w-[600px] -translate-x-1/2">
    <div class="flex-1 min-w-0">
      We use essential cookies to make our site work. With your consent, we may also use non-essential cookies to improve user experience and analyze website traffic. By clicking "Accept", you agree to our website's cookie use as described in our <a href="#" class="text-yellow-700 underline font-semibold">Cookie Policy</a>. You can change your cookie settings at any time by clicking "Preferences."
        </div>
    <div class="flex flex-col gap-2 min-w-[180px] ml-4">
      <button class="cookie-btn-prefs bg-white border-2 border-yellow-400 rounded-md px-4 py-2 font-bold text-yellow-700 hover:bg-yellow-200">Preferences</button>
      <button class="cookie-btn-decline bg-yellow-50 border-2 border-yellow-500 rounded-md px-4 py-2 font-bold text-yellow-700 hover:bg-yellow-200">Decline</button>
      <button class="cookie-btn-accept bg-yellow-400 border-2 border-yellow-500 rounded-md px-4 py-2 font-bold text-white hover:bg-yellow-500">Accept</button>
        </div>
      </div>
  <!-- Scrolling Banner -->
  <div id="scrolling-banner" class="hidden fixed top-0 left-0 w-full min-h-[64px] bg-cover bg-center z-[2000] flex items-center shadow-md text-white text-lg font-bold overflow-hidden" style="background-image:url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1200&q=80');">
    <div class="bg-black bg-opacity-50 px-8 py-3 rounded-xl max-w-full whitespace-nowrap animate-marquee">
      Visual Regression Testing Mode Active — Dynamic UI changes enabled for testing — Try different parameters for font, color, layout, and image — Test accessibility and responsiveness — Simulate visual bugs and edge cases — Easily reset or combine features for robust regression testing
    </div>
  </div>
  <!-- Overlay for panels -->
  <div id="panel-overlay" class="fixed inset-0 bg-black bg-opacity-40 z-40 hidden transition-opacity duration-300"></div>
  <footer class="w-full text-center text-gray-800 text-sm mt-8">
    Creator. Builder. Curious? Let's talk &rarr; <a href="https://linkedin.com/in/vijopv83" target="_blank" class="text-purple-500 underline">linkedin.com/in/vijopv83</a>
  </footer>
  <!-- Language Modal -->
  <div id="lang-modal" class="hidden fixed inset-0 flex items-center justify-center z-[3000] bg-black bg-opacity-40">
    <div class="bg-white p-8 rounded-2xl shadow-2xl w-[90vw] max-w-[340px] text-center relative flex flex-col items-center border border-gray-200">
      <button id="lang-modal-close" class="absolute top-3 right-4 text-2xl text-purple-500 hover:text-purple-700 transition">&times;</button>
      <div class="text-lg font-bold text-gray-800 mb-4">Your language</div>
      <select id="lang-select" class="w-full border border-gray-300 rounded px-3 py-2 mb-2 focus:outline-none focus:ring-2 focus:ring-purple-400">
        <option value="en">English</option>
        <option value="nl">Nederlands</option>
        <option value="fr">français</option>
        <option value="de">Deutsch</option>
        <option value="it">italiano</option>
        <option value="es">español</option>
        <option value="hi">हिन्दी</option>
        <option value="bn">বাংলা</option>
        <option value="te">తెలుగు</option>
        <option value="mr">मराठी</option>
        <option value="ml">മലയാളം</option>
        <option value="ar">العربية</option>
      </select>
      <button id="lang-apply" class="w-full mt-2 px-4 py-2 bg-purple-500 text-white rounded font-semibold shadow hover:bg-purple-600 transition">Apply</button>
    </div>
  </div>
  <script>
(function() {
  // Utility: Debounce
  function debounce(fn, delay) {
    let t; return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), delay); };
  }

  // Password toggle
  window.togglePassword = function() {
    const passwordInput = document.getElementById('password');
    const eyeIcon = document.getElementById('eyeIcon');
    if (passwordInput.type === 'password') {
      passwordInput.type = 'text';
      eyeIcon.classList.remove('fa-eye');
      eyeIcon.classList.add('fa-eye-slash');
    } else {
      passwordInput.type = 'password';
      eyeIcon.classList.remove('fa-eye-slash');
      eyeIcon.classList.add('fa-eye');
    }
  };

  document.addEventListener('DOMContentLoaded', function() {
    // --- System Info Side Panel ---
    const openSidePanelBtn = document.getElementById('open-side-panel-btn');
    const sidePanel = document.getElementById('side-panel');
    const sidePanelClose = document.getElementById('side-panel-close');
    const overlay = document.getElementById('panel-overlay');
    function updateSystemInfo() {
    const sidePanelContent = document.getElementById('side-panel-content');
      // Gather info
      const getOS = () => {
        const ua = window.navigator.userAgent;
        if (ua.indexOf('Win') !== -1) return 'Windows';
        if (ua.indexOf('Mac') !== -1) return 'MacOS';
        if (ua.indexOf('Linux') !== -1) return 'Linux';
        if (ua.indexOf('Android') !== -1) return 'Android';
        if (ua.indexOf('like Mac') !== -1) return 'iOS';
        return 'Unknown';
      };
      const getBrowserAndVersion = () => {
        const ua = navigator.userAgent;
        let browser = 'Unknown', version = '';
        if (/Edg\/(\d+\.\d+)/.test(ua)) {
          browser = 'Edge'; version = ua.match(/Edg\/(\d+\.\d+)/)[1];
        } else if (/OPR\/(\d+\.\d+)/.test(ua)) {
          browser = 'Opera'; version = ua.match(/OPR\/(\d+\.\d+)/)[1];
        } else if (/Chrome\/(\d+\.\d+)/.test(ua)) {
          browser = 'Chrome'; version = ua.match(/Chrome\/(\d+\.\d+)/)[1];
        } else if (/Firefox\/(\d+\.\d+)/.test(ua)) {
          browser = 'Firefox'; version = ua.match(/Firefox\/(\d+\.\d+)/)[1];
        } else if (/Version\/(\d+\.\d+).*Safari/.test(ua)) {
          browser = 'Safari'; version = ua.match(/Version\/(\d+\.\d+)/)[1];
        }
        return browser + (version ? ' ' + version : '');
      };
      // Info values
      let os = getOS();
      let browser = getBrowserAndVersion();
      let screenRes = `${window.screen.width} x ${window.screen.height}`;
      let availScreenRes = `${window.screen.availWidth} x ${window.screen.availHeight}`;
      let viewportRes = `${window.innerWidth} x ${window.innerHeight}`;
      let outerWindowRes = `${window.outerWidth} x ${window.outerHeight}`;
      let dpr = window.devicePixelRatio;
      let lang = navigator.language;
      let platform = navigator.platform;
      let userAgent = navigator.userAgent;
      let osVersion = 'N/A';
      let networkSpeed = 'N/A';
      let networkType = 'N/A';
      let chargingStatus = 'N/A';
      let batteryLevel = 'N/A';
      let ip = 'N/A';
      let country = 'N/A';
      let screenshotDims = `${window.innerWidth} x ${window.innerHeight}`;
      let connectionType = 'N/A';
      let isMetered = 'N/A';
      let isOnline = navigator.onLine ? 'Online' : 'Offline';
      let deviceMemory = 'N/A';
      let cpuCores = 'N/A';
      let touchSupport = 'N/A';
      let cookiesEnabled = navigator.cookieEnabled ? 'Yes' : 'No';
      let doNotTrack = (navigator.doNotTrack === '1' || navigator.doNotTrack === 'yes') ? 'Yes' : 'No';
      let referrer = document.referrer || 'N/A';
      if (/Mac OS X ([\d_]+)/.test(userAgent)) {
        osVersion = 'MacOS ' + userAgent.match(/Mac OS X ([\d_]+)/)[1].replace(/_/g, '.');
      } else if (/Windows NT ([\d.]+)/.test(userAgent)) {
        osVersion = 'Windows NT ' + userAgent.match(/Windows NT ([\d.]+)/)[1];
      } else if (/Android ([\d.]+)/.test(userAgent)) {
        osVersion = 'Android ' + userAgent.match(/Android ([\d.]+)/)[1];
      } else if (/iPhone OS ([\d_]+)/.test(userAgent)) {
        osVersion = 'iOS ' + userAgent.match(/iPhone OS ([\d_]+)/)[1].replace(/_/g, '.');
      }
      if (navigator.connection) {
        if (typeof navigator.connection.downlink !== 'undefined') {
          networkSpeed = navigator.connection.downlink + ' Mbps';
        }
        if (typeof navigator.connection.effectiveType !== 'undefined') {
          networkType = navigator.connection.effectiveType;
        }
        if (typeof navigator.connection.type !== 'undefined') {
          connectionType = navigator.connection.type;
        }
        if (typeof navigator.connection.metered !== 'undefined') {
          isMetered = navigator.connection.metered ? 'Yes' : 'No';
        }
      }
      if (navigator.deviceMemory) {
        deviceMemory = navigator.deviceMemory + ' GB';
      }
      if (navigator.hardwareConcurrency) {
        cpuCores = navigator.hardwareConcurrency;
      }
      if (typeof navigator.maxTouchPoints !== 'undefined') {
        touchSupport = navigator.maxTouchPoints > 0 ? navigator.maxTouchPoints : 'No';
      }
      // Async battery and IP
      if (navigator.getBattery) {
        navigator.getBattery().then(function(battery) {
          chargingStatus = battery.charging ? 'Charging' : 'Not Charging';
          batteryLevel = Math.round(battery.level * 100) + '%';
          render();
        }).catch(function() {
          chargingStatus = 'N/A';
          batteryLevel = 'N/A';
          render();
        });
      }
      fetch('https://ipapi.co/json/')
        .then(res => res.json())
        .then(data => {
          ip = data.ip || 'N/A';
          country = data.country_name || 'N/A';
          render();
        }).catch(() => {
          ip = 'N/A';
          country = 'N/A';
          render();
        });
      function render(activeTabId = 'device') {
        const tabs = [
          { id: 'device', label: 'Device' },
          { id: 'display', label: 'Display' },
          { id: 'network', label: 'Network' }
        ];
        const tabContent = {
          device: `
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">OS Version:</span> <span class="sysval">${osVersion}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Platform:</span> <span class="sysval">${platform}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Language:</span> <span class="sysval">${lang}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Device Memory:</span> <span class="sysval">${deviceMemory}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">CPU Cores:</span> <span class="sysval">${cpuCores}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Touch Support:</span> <span class="sysval">${touchSupport}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Battery Status:</span> <span class="sysval">${batteryLevel} ${chargingStatus}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Browser:</span> <span class="sysval">${browser}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">User Agent:</span> <span class="sysval break-all text-xs">${userAgent}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Cookies Enabled:</span> <span class="sysval">${cookiesEnabled}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Do Not Track:</span> <span class="sysval">${doNotTrack}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Referrer:</span> <span class="sysval break-all">${referrer}</span></div>
          `,
          display: `
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Screen Resolution:</span> <span class="sysval">${screenRes}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Available Screen:</span> <span class="sysval">${availScreenRes}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Window Size (outer):</span> <span class="sysval">${outerWindowRes}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Viewport Size (inner):</span> <span class="sysval">${viewportRes}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Screenshot Dimensions:</span> <span class="sysval">${screenshotDims}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Device Pixel Ratio:</span> <span class="sysval">${dpr}</span></div>
          `,
          network: `
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Network Speed:</span> <span class="sysval">${networkSpeed}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Network Type:</span> <span class="sysval">${networkType}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Connection Type:</span> <span class="sysval">${connectionType}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Metered Connection:</span> <span class="sysval">${isMetered}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Online Status:</span> <span class="sysval">${isOnline}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">Country:</span> <span class="sysval">${country}</span></div><hr class="sysinfo-hr">
            <div class="sysinfo-row flex justify-between items-center text-sm mb-2"><span class="font-medium">IP Address:</span> <span class="sysval">${ip}</span></div>
          `
        };
        const tabBar = `
          <div id="sysinfo-tabs" class="flex gap-1 mb-3">
            ${tabs.map(tab => `<button class="sysinfo-tab flex-1 py-1.5 text-xs rounded-t-md font-semibold tab-inactive" data-tab="${tab.id}">${tab.label}</button>`).join('')}
          </div>
        `;
        sidePanelContent.innerHTML = `
          ${tabBar}
          <div id="sysinfo-tab-content" class="min-h-[90px]">
            ${tabs.map(tab => `<div id="sysinfo-content-${tab.id}" class="${tab.id === activeTabId ? '' : 'hidden'}">${tabContent[tab.id]}</div>`).join('')}
          </div>
        `;
        // Tab switching logic
        const tabBtns = sidePanelContent.querySelectorAll('.sysinfo-tab');
        const tabDivs = sidePanelContent.querySelectorAll('#sysinfo-tab-content > div');
        tabBtns.forEach(btn => {
          btn.onclick = function() {
            tabBtns.forEach(b => b.classList.remove('tab-active'));
            tabDivs.forEach(d => d.classList.add('hidden'));
            btn.classList.add('tab-active');
            const tabId = btn.getAttribute('data-tab');
            const contentDiv = sidePanelContent.querySelector(`#sysinfo-content-${tabId}`);
            if(contentDiv) contentDiv.classList.remove('hidden');
          };
        });
        // Set default tab
        if(tabBtns.length) tabBtns[0].classList.add('tab-active');
        if(tabDivs.length) tabDivs[0].classList.remove('hidden');
      }
      render();
    }
    function showOverlay() {
      overlay.classList.remove('hidden');
      overlay.classList.add('opacity-100');
    }
    function hideOverlay() {
      overlay.classList.add('hidden');
      overlay.classList.remove('opacity-100');
    }
    openSidePanelBtn.onclick = function() {
      sidePanel.classList.remove('side-panel-closed');
      sidePanel.classList.add('side-panel-open');
      sidePanel.style.left = '0';
      updateSystemInfo();
      showOverlay();
    };
    sidePanelClose.onclick = function() {
      sidePanel.classList.remove('side-panel-open');
      sidePanel.classList.add('side-panel-closed');
      sidePanel.style.left = '-400px';
      hideOverlay();
    };
    sidePanel.classList.add('side-panel-closed');

    // --- Image Slider ---
    const sliderDots = document.getElementById('slider-dots');
    const sliderImg = document.getElementById('slider-img');
    const images = [
      'https://images.unsplash.com/photo-1513258496099-48168024aec0?auto=format&fit=crop&w=540&q=80',
      'https://images.unsplash.com/photo-1521737852567-6949f3f9f2b5?auto=format&fit=crop&w=540&q=80',
      'https://images.unsplash.com/photo-1519389950473-47ba0277781c?auto=format&fit=crop&w=540&q=80'
    ];
    function getUrlParam(name) {
      return new URLSearchParams(window.location.search).get(name);
    }
    function showSlider(enabled) {
      if (enabled) {
        sliderDots.style.display = '';
        let idx = 0;
        function renderDots() {
          sliderDots.innerHTML = '';
          images.forEach((_, i) => {
            const dot = document.createElement('span');
            dot.className = 'w-3 h-3 rounded-full border-2 border-white bg-white opacity-60 mx-1 cursor-pointer' + (i === idx ? ' opacity-100 bg-purple-500' : '');
            dot.onclick = () => {
              idx = i;
              sliderImg.src = images[idx];
              renderDots();
            };
            sliderDots.appendChild(dot);
          });
        }
        renderDots();
        if (window.sliderInterval) clearInterval(window.sliderInterval);
        window.sliderInterval = setInterval(() => {
          idx = (idx + 1) % images.length;
          sliderImg.src = images[idx];
          renderDots();
        }, 4000);
          } else {
        sliderImg.src = images[0];
        sliderDots.style.display = 'none';
        if (window.sliderInterval) clearInterval(window.sliderInterval);
      }
    }
    showSlider(getUrlParam('slider') === 'on');
    window.addEventListener('popstate', () => {
      showSlider(getUrlParam('slider') === 'on');
    });

    // --- Visual Regression Parameters Panel Logic ---
    const helpIcon = document.getElementById('help-icon');
    const helpPanel = document.getElementById('help-panel');
    const helpClose = document.getElementById('help-close');
    const paramForm = document.getElementById('param-form');
    const paramTabs = document.getElementById('param-tabs');
    const paramApply = document.getElementById('param-apply');
    const paramReset = document.getElementById('param-reset');
    const PARAM_SECTIONS = [
      {title: 'Typography', keys: ['font', 'fontSize', 'fontColour', 'fontBold', 'fallbackFont', 'subheadingStyle']},
      {title: 'Layout', keys: ['offsetVertical', 'offsetHorizontal', 'border', 'shadow', 'rtl', 'grid', 'ruler']},
      {title: 'Theme & Effects', keys: ['theme', 'invert', 'anim', 'banner', 'toast', 'popup', 'cookie', 'floatingBox']},
      {title: 'Form & UX', keys: ['hideForm', 'buttonStyle', 'hideSocial', 'timer', 'disableLogin', 'inputError', 'hideFooter']},
      {title: 'Image', keys: ['blur', 'grayscale', 'overlay', 'highContrast', 'hideImage', 'slider', 'brokenImage', 'randomPixel', 'distortedImage']}
    ];
    const PARAMS = [
      {key:'theme', label:'Dark Theme', value:'on', type:'checkbox'},
      {key:'font', label:'Serif Font', value:'serif', type:'radio', group:'font'},
      {key:'font', label:'Sans Font', value:'sans', type:'radio', group:'font', default: true},
      {key:'font', label:'Mono Font', value:'mono', type:'radio', group:'font'},
      {key:'font', label:'Roboto Font', value:'roboto', type:'radio', group:'font'},
      {key:'fontSize', label:'Large Font', value:'large', type:'radio', group:'fontSize'},
      {key:'fontSize', label:'Normal Font', value:'normal', type:'radio', group:'fontSize', default: true},
      {key:'fontSize', label:'Small Font', value:'small', type:'radio', group:'fontSize'},
      {key:'fontBold', label:'Bold', value:'on', type:'checkbox'},
      {key:'fontColour', label:'Font Colour', value:'', type:'color'},
      {key:'subheadingStyle', label:'Default Subheading', value:'default', type:'radio', group:'subheadingStyle', default: true},
      {key:'subheadingStyle', label:'Custom Subheading', value:'custom', type:'radio', group:'subheadingStyle'},
      {key:'subheadingStyle', label:'Long Subheading', value:'long', type:'radio', group:'subheadingStyle'},
      {key:'subheadingStyle', label:'Long Subheading with Ellipsis', value:'ellipsis', type:'radio', group:'subheadingStyle'},
      {key:'offsetVertical', label:'Offset Vertical', value:'on', type:'checkbox'},
      {key:'offsetHorizontal', label:'Offset Horizontal', value:'on', type:'checkbox'},
      {key:'border', label:'Border on Card', value:'on', type:'checkbox'},
      {key:'shadow', label:'No Shadow', value:'off', type:'checkbox'},
      {key:'anim', label:'Animate Elements', value:'on', type:'checkbox'},
      {key:'rtl', label:'Right-to-Left Layout', value:'on', type:'checkbox'},
      {key:'invert', label:'Invert Colors', value:'on', type:'checkbox'},
      {key:'hideFooter', label:'Hide Footer', value:'on', type:'checkbox'},
      {key:'grid', label:'Show Grid', value:'on', type:'checkbox'},
      {key:'ruler', label:'Show Ruler', value:'on', type:'checkbox'},
      {key:'banner', label:'Show Banner', value:'on', type:'checkbox'},
      {key:'cookie', label:'Show Cookie Banner', value:'on', type:'checkbox'},
      {key:'popup', label:'Show Popup', value:'on', type:'checkbox'},
      {key:'toast', label:'Show Toast', value:'on', type:'checkbox'},
      {key:'blur', label:'Blur Image', value:'on', type:'checkbox'},
      {key:'grayscale', label:'Grayscale Image', value:'on', type:'checkbox'},
      {key:'overlay', label:'Overlay', value:'on', type:'checkbox'},
      {key:'highContrast', label:'High Contrast', value:'on', type:'checkbox'},
      {key:'hideImage', label:'Hide Image', value:'on', type:'checkbox'},
      {key:'slider', label:'Enable Image Slider', value:'on', type:'checkbox'},
      {key:'brokenImage', label:'Simulate Broken Image', value:'on', type:'checkbox'},
      {key:'randomPixel', label:'Random Pixel', value:'on', type:'checkbox'},
      {key:'distortedImage', label:'Distorted Image', value:'on', type:'checkbox'},
      {key:'hideForm', label:'Hide Form', value:'on', type:'checkbox'},
      {key:'buttonStyle', label:'Alternate Button Style', value:'alt', type:'checkbox'},
      {key:'hideSocial', label:'Hide One Social Button', value:'on', type:'checkbox'},
      {key:'timer', label:'Show Countdown', value:'on', type:'checkbox'},
      {key:'floatingBox', label:'Show Floating Box', value:'on', type:'checkbox'},
      {key:'inputError', label:'Show Input Error', value:'on', type:'checkbox'},
    ];
    let activeParamTab = 0;
    function getDefaultParams() {
      const defaults = {};
      PARAMS.forEach(p => {
        if (p.type === 'radio' && p.default) defaults[p.key] = p.value;
        if (p.type === 'checkbox' && p.default) defaults[p.key] = p.value;
        if (p.type === 'color' && p.default) defaults[p.key] = p.default;
      });
      // Set shadow to ON by default
      defaults.shadow = 'on';
      // Set fontSize to normal by default
      if (!defaults.fontSize) defaults.fontSize = 'normal';
      return defaults;
    }
    function getCurrentParams() {
      const params = new URLSearchParams(window.location.search);
      return Object.fromEntries(params.entries());
    }
    function renderParamTabs(activeIdx = 0) {
      paramTabs.innerHTML = PARAM_SECTIONS.map((section, i) =>
        `<button class="param-tab px-3 py-1 rounded-t font-semibold text-xs ${i === activeIdx ? 'bg-purple-500 text-white' : 'bg-purple-100 text-purple-700'}" data-tabidx="${i}">${section.title}</button>`
      ).join('');
    }
    function renderParamForm(activeIdx = 0) {
      paramForm.innerHTML = '';
      const current = getCurrentParams();
      const section = PARAM_SECTIONS[activeIdx];
      const formGrid = document.createElement('div');
      formGrid.className = 'grid grid-cols-2 gap-2';
      section.keys.forEach(key => {
        PARAMS.filter(p => p.key === key).forEach(param => {
          let checked = false;
          if (param.type === 'checkbox') checked = current[param.key] === param.value;
          if (param.type === 'radio') {
            if (current[param.key]) checked = current[param.key] === param.value;
            else if (param.default) checked = true;
          }
          if (param.type === 'color') checked = !!current[param.key];
          if (param.type === 'number') checked = !!current[param.key];
          const label = document.createElement('label');
          label.className = 'flex items-center gap-2 mb-1 cursor-pointer px-2 py-1 transition';
          if (checked) label.classList.add('font-semibold');
          if (param.type === 'checkbox') {
            const input = document.createElement('input');
            input.type = 'checkbox';
            input.name = param.key;
            input.value = param.value;
            input.checked = checked;
            input.className = 'accent-purple-500';
            input.onchange = function() {
              const params = new URLSearchParams(window.location.search);
              if (input.checked) params.set(input.name, input.value);
              else params.delete(input.name);
              window.history.replaceState({}, '', `${window.location.pathname}?${params}`);
              applyVisualParams();
              renderParamForm(activeParamTab);
              setTimeout(applyVisualParams, 10);
            };
            label.appendChild(input);
            label.appendChild(document.createTextNode(param.label));
            formGrid.appendChild(label);
          } else if (param.type === 'radio') {
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = param.group;
            input.value = param.value;
            input.checked = checked;
            input.className = 'accent-purple-500';
            input.onchange = function() {
              const params = new URLSearchParams(window.location.search);
              params.set(param.group, input.value);
              window.history.replaceState({}, '', `${window.location.pathname}?${params}`);
              applyVisualParams();
              renderParamForm(activeParamTab);
            };
            label.appendChild(input);
            label.appendChild(document.createTextNode(param.label));
            if (param.default) {
              const defaultSpan = document.createElement('span');
              defaultSpan.className = 'ml-2 text-xs text-gray-400 font-normal';
              defaultSpan.innerText = '(default)';
              label.appendChild(defaultSpan);
            }
            formGrid.appendChild(label);
          } else if (param.type === 'color') {
            const input = document.createElement('input');
            input.type = 'color';
            input.name = param.key;
            input.value = current[param.key] || '#2d2d2d';
            input.className = 'w-6 h-6 p-0 border-0';
            input.oninput = debounce(function() {
              const params = new URLSearchParams(window.location.search);
              params.set(input.name, input.value);
              window.history.replaceState({}, '', `${window.location.pathname}?${params}`);
              applyVisualParams();
            }, 200);
            label.appendChild(document.createTextNode(param.label));
            label.appendChild(input);
            formGrid.appendChild(label);
          }
        });
      });
      paramForm.appendChild(formGrid);
    }
    // Tab event delegation
    paramTabs.addEventListener('click', function(e) {
      const btn = e.target.closest('.param-tab');
      if (!btn) return;
      activeParamTab = parseInt(btn.getAttribute('data-tabidx'));
      renderParamTabs(activeParamTab);
      renderParamForm(activeParamTab);
    });
    function showToast() {
      let toast = document.getElementById('toast');
      if (!toast) {
        toast = document.createElement('div');
        toast.id = 'toast';
        toast.className = 'fixed top-8 left-1/2 transform -translate-x-1/2 z-50 flex flex-col items-center space-y-2';
        document.body.appendChild(toast);
      }
      const types = [
        {cls:'bg-green-500', txt:'Success!', icon:'fa-check-circle'},
        {cls:'bg-red-500', txt:'Error!', icon:'fa-times-circle'},
        {cls:'bg-yellow-400 text-black', txt:'Warning!', icon:'fa-exclamation-triangle'},
        {cls:'bg-blue-500 text-white', txt:'Info!', icon:'fa-info-circle'},
        {cls:'bg-gray-700', txt:'Failure!', icon:'fa-bug'}
      ];
      const t = types[Math.floor(Math.random()*types.length)];
      const el = document.createElement('div');
      el.className = `flex items-center gap-2 mb-2 px-4 py-2 rounded shadow-lg text-white font-bold ${t.cls} animate-fadeIn`;
      el.innerHTML = `<i class=\"fa-solid ${t.icon}\"></i> ${t.txt}`;
      toast.appendChild(el);
      setTimeout(()=>{el.classList.add('opacity-0'); setTimeout(()=>el.remove(),500);}, 10000);
    }
    function showCookieBanner() {
      if (document.getElementById('cookie-banner')) return;
      const banner = document.createElement('div');
      banner.id = 'cookie-banner';
      banner.className = 'fixed left-1/2 bottom-8 bg-yellow-100 text-gray-900 shadow-xl px-8 py-6 flex items-start justify-between z-[1000] text-base rounded-xl border-2 border-yellow-400 min-w-[320px] max-w-[600px] -translate-x-1/2';
      banner.innerHTML = `<div class="flex-1 min-w-0">We use essential cookies to make our site work. With your consent, we may also use non-essential cookies to improve user experience and analyze website traffic. By clicking \"Accept\", you agree to our website's cookie use as described in our <a href="#" class="text-yellow-700 underline font-semibold">Cookie Policy</a>. You can change your cookie settings at any time by clicking \"Preferences.\"</div><div class="flex flex-col gap-2 min-w-[180px] ml-4"><button class="cookie-btn-prefs bg-white border-2 border-yellow-400 rounded-md px-4 py-2 font-bold text-yellow-700 hover:bg-yellow-200">Preferences</button><button class="cookie-btn-decline bg-yellow-50 border-2 border-yellow-500 rounded-md px-4 py-2 font-bold text-yellow-700 hover:bg-yellow-200">Decline</button><button class="cookie-btn-accept bg-yellow-400 border-2 border-yellow-500 rounded-md px-4 py-2 font-bold text-white hover:bg-yellow-500">Accept</button></div>`;
      document.body.appendChild(banner);
      banner.querySelector('.cookie-btn-accept').onclick = function() { banner.remove(); };
      banner.querySelector('.cookie-btn-decline').onclick = function() { banner.remove(); };
      banner.querySelector('.cookie-btn-prefs').onclick = function() { alert('Cookie preferences dialog would open.'); };
    }
    function showPopup() {
      if (document.getElementById('popup-modal')) return;
      const popup = document.createElement('div');
      popup.id = 'popup-modal';
      popup.className = 'fixed inset-0 flex items-center justify-center z-[3000] bg-black bg-opacity-40';
      popup.innerHTML = `
        <div class="bg-white dark:bg-gray-900 p-8 rounded-2xl shadow-2xl w-[60vw] max-w-[400px] text-center relative flex flex-col items-center border border-gray-200 dark:border-gray-700">
          <button id="popup-close" class="absolute top-3 right-4 text-2xl text-purple-500 hover:text-purple-700 transition">&times;</button>
          <div class="text-2xl font-bold text-gray-800 dark:text-gray-100 mb-2 flex items-center gap-2"><i class="fa-solid fa-circle-info text-purple-500"></i> Visual Regression Modal</div>
          <div class="mb-4 text-gray-600 dark:text-gray-300">This is a realistic popup/modal. You triggered this by adding <b>popup=on</b> to the URL or toggling Visual Regression Parameters.<br><br>Popups are useful for onboarding, warnings, confirmations, and more. You can style and animate them as needed.</div>
          <button id="popup-action" class="mt-2 px-5 py-2 bg-purple-500 text-white rounded-lg font-semibold shadow hover:bg-purple-600 transition">Got it!</button>
        </div>
      `;
      document.body.appendChild(popup);
      popup.querySelector('#popup-close').onclick = function() { popup.remove(); };
      popup.querySelector('#popup-action').onclick = function() { popup.remove(); };
    }
    function showBanner() {
      let banner = document.getElementById('scrolling-banner');
      if (!banner) {
        banner = document.createElement('div');
        banner.id = 'scrolling-banner';
        banner.className = 'fixed top-0 left-0 w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white text-center py-2 z-50 animate-marquee';
        banner.innerHTML = '<span class="font-bold">🚀 Visual Regression Testing Mode Active — Dynamic UI changes enabled for testing — Try different parameters for font, color, layout, and image — Test accessibility and responsiveness — Simulate visual bugs and edge cases — Easily reset or combine features for robust regression testing</span>';
        document.body.appendChild(banner);
      }
      banner.style.display = '';
    }
    function showRuler() {
      let ruler = document.getElementById('ruler-overlay');
      if (!ruler) {
        ruler = document.createElement('div');
        ruler.id = 'ruler-overlay';
        ruler.className = 'pointer-events-none fixed inset-0 z-50';
        // Top and left rulers start at 0, increment by 1, lines at every 0.25, labels at major lines
        const topTicks = 7; // 0 to 6
        const leftTicks = 5; // 0 to 4
        // Top labels and major vertical lines
        let topRuler = '';
        for(let i=0;i<topTicks;i++){
          const left = `calc(32px + ${(i/(topTicks-1))*100}% )`;
          topRuler += `<div style=\"position:absolute;left:${left};top:0;width:32px;height:24px;display:flex;align-items:center;justify-content:center;font-size:16px;color:#f00;font-weight:bold;transform:translateX(-50%);\">${i}</div>`;
        }
        // Left labels and major horizontal lines
        let leftRuler = '';
        for(let i=0;i<leftTicks;i++){
          const top = `calc(24px + ${(i/(leftTicks-1))*100}% )`;
          leftRuler += `<div style=\"position:absolute;left:0;top:${top};width:32px;height:24px;display:flex;align-items:center;justify-content:center;font-size:16px;color:#f00;font-weight:bold;transform:translateY(-50%);\">${i}</div>`;
        }
        // Draw vertical lines (major and minor)
        let lines = '';
        for(let i=0;i<topTicks;i++){
          const left = `calc(32px + ${(i/(topTicks-1))*100}% )`;
          lines += `<div style=\"position:absolute;top:24px;left:${left};width:2px;height:calc(100% - 24px);background:#f00;opacity:0.7;\"></div>`;
          // Minor lines between majors
          if(i<topTicks-1){
            for(let j=1;j<4;j++){
              const minorLeft = `calc(32px + ${((i+j/4)/(topTicks-1))*100}% )`;
              lines += `<div style=\"position:absolute;top:24px;left:${minorLeft};width:1px;height:calc(100% - 24px);background:#888;opacity:0.3;\"></div>`;
            }
          }
        }
        // Draw horizontal lines (major and minor)
        for(let i=0;i<leftTicks;i++){
          const top = `calc(24px + ${(i/(leftTicks-1))*100}% )`;
          lines += `<div style=\"position:absolute;left:32px;top:${top};height:2px;width:calc(100% - 32px);background:#f00;opacity:0.7;\"></div>`;
          // Minor lines between majors
          if(i<leftTicks-1){
            for(let j=1;j<4;j++){
              const minorTop = `calc(24px + ${((i+j/4)/(leftTicks-1))*100}% )`;
              lines += `<div style=\"position:absolute;left:32px;top:${minorTop};height:1px;width:calc(100% - 32px);background:#888;opacity:0.3;\"></div>`;
            }
          }
        }
        // 0,0 label in the corner
        let corner = '<div style="position:absolute;left:0;top:0;width:32px;height:24px;display:flex;align-items:center;justify-content:center;font-size:16px;color:#f00;font-weight:bold;">0,0</div>';
        ruler.innerHTML = `${topRuler}${leftRuler}${lines}${corner}`;
        document.body.appendChild(ruler);
      }
      ruler.style.display = '';
    }
    function hideRuler() {
      const ruler = document.getElementById('ruler-overlay');
      if (ruler) ruler.style.display = 'none';
    }
    function hideBanner() {
      const banner = document.getElementById('scrolling-banner');
      if (banner) banner.style.display = 'none';
    }
    function hidePopup() {
      const popup = document.getElementById('popup-modal');
      if (popup) popup.remove();
    }
    function hideCookieBanner() {
      const banner = document.getElementById('cookie-banner');
      if (banner) banner.remove();
    }
    function applyVisualParams() {
      const params = getCurrentParams();
      const card = document.getElementById('main-card');
      const footer = document.getElementById('footer');
      const settingsIcon = document.getElementById('settings-icon');
      const sysHeader = document.getElementById('side-panel-header');
      document.querySelectorAll('.fancy-btn').forEach(btn=>btn.classList.remove('animate-bounce'));
      if(params.anim) {
        card && card.classList.add('animate-fadeIn'); setTimeout(()=>card && card.classList.remove('animate-fadeIn'), 800);
        settingsIcon && settingsIcon.classList.add('animate-spin');
        sysHeader && sysHeader.classList.add('animate-pulse');
        document.querySelectorAll('.fancy-btn').forEach(btn=>btn.classList.add('animate-bounce'));
      } else {
        settingsIcon && settingsIcon.classList.remove('animate-spin');
        sysHeader && sysHeader.classList.remove('animate-pulse');
      }
      card && (card.style.marginTop = params.offsetVertical ? '5px' : '');
      card && (card.style.marginLeft = params.offsetHorizontal ? '5px' : '');
      card && (params.border ? card.classList.add('border-2','border-purple-400') : card.classList.remove('border-2','border-purple-400'));
      footer && (footer.style.visibility = params.hideFooter ? 'hidden' : '');
      let floatBox = document.getElementById('floating-box');
      if(params.floatingBox) {
        if(!floatBox) {
          floatBox = document.createElement('div');
          floatBox.id = 'floating-box';
          floatBox.className = 'fixed top-20 right-20 bg-purple-100 border-2 border-purple-400 rounded-xl shadow-lg px-6 py-4 z-50 animate-bounce';
          floatBox.innerHTML = '<b>Floating Box</b><br>This is a floating box.';
          document.body.appendChild(floatBox);
        }
        floatBox.style.display = '';
      } else if(floatBox) { floatBox.style.display = 'none'; }
      let timer = document.getElementById('countdown-timer');
      if(params.timer) {
        timer.style.display = '';
        let count = 10;
        timer.innerText = `Countdown: ${count}`;
        clearInterval(timer._interval);
        timer._interval = setInterval(()=>{
          count--;
          timer.innerText = `Countdown: ${count}`;
          if(count <= 0) { clearInterval(timer._interval); timer.innerText = 'Done!'; }
        }, 1000);
      } else {
        timer.style.display = 'none';
        clearInterval(timer._interval);
      }
      let emailError = document.getElementById('email-error');
      if(params.inputError) {
        if(!emailError) {
          emailError = document.createElement('div');
          emailError.id = 'email-error';
          emailError.className = 'text-red-500 text-xs mt-1';
          emailError.innerText = 'Invalid email address.';
          const emailInput = document.getElementById('email');
          emailInput && emailInput.parentNode.appendChild(emailError);
        }
        emailError.style.display = '';
      } else if(emailError) { emailError.style.display = 'none'; }
      if(params.ruler) showRuler(); else hideRuler();
      // --- Font & Text ---
      // Font family
      document.body.classList.remove('font-serif','font-sans','font-mono','font-roboto');
      if(params.font === 'serif') document.body.classList.add('font-serif');
      else if(params.font === 'mono') document.body.classList.add('font-mono');
      else if(params.font === 'roboto') {
        document.body.style.fontFamily = 'Roboto, Arial, sans-serif';
        document.body.classList.add('font-roboto');
      } else document.body.classList.add('font-sans');
      // Font size
      document.body.classList.remove('text-lg','text-base','text-sm');
      if(params.fontSize === 'large') document.body.classList.add('text-lg');
      else if(params.fontSize === 'small') document.body.classList.add('text-sm');
      else document.body.classList.add('text-base');
      // Font colour
      if(params.fontColour) document.body.style.color = params.fontColour;
      else document.body.style.color = '';
      // Bold
      document.body.classList.toggle('font-bold', !!params.fontBold);
      // Subheading radio logic
      const subtitle = document.getElementById('login-subtitle');
      subtitle.classList.remove('truncate','cursor-help');
      subtitle.removeAttribute('title');
      const longSubheadingFull = 'Welcome back! Please enter your details. This is a very long subheading to test overflow and wrapping in the login panel. It should wrap and remain readable.';
      const longSubheadingTrimmed = 'Welcome back! Please enter your details...';
      if(params.subheadingStyle === 'custom') {
        subtitle.innerText = 'Custom subheading for visual regression.';
      } else if(params.subheadingStyle === 'long') {
        subtitle.innerText = longSubheadingFull;
      } else if(params.subheadingStyle === 'ellipsis') {
        subtitle.innerText = longSubheadingTrimmed;
        subtitle.classList.add('truncate','cursor-help');
        subtitle.title = longSubheadingFull;
        subtitle.style.maxWidth = '100%';
        subtitle.style.display = 'block';
      } else {
        subtitle.innerText = 'Welcome back! Please enter your details';
      }
      // Fallback Font
      document.body.style.fontFamily = params.fallbackFont ? 'Arial, sans-serif' : '';
      // --- Layout & Visuals ---
      // No Shadow
      card && (params.shadow==='off' || params.shadow===false ? card.classList.remove('shadow-2xl') : card.classList.add('shadow-2xl'));
      // Right-to-Left Layout
      document.body.dir = params.rtl ? 'rtl' : 'ltr';
      // Dark Theme
      if(params.theme) document.body.classList.add('dark'); else document.body.classList.remove('dark');
      // Invert Colors
      if(params.invert) document.body.classList.add('invert','[filter:invert(1)]'); else document.body.classList.remove('invert','[filter:invert(1)]');
      // Show Grid
      let grid = document.getElementById('grid-overlay');
      if(params.grid) {
        if(!grid) {
          grid = document.createElement('div');
          grid.id = 'grid-overlay';
          grid.className = 'pointer-events-none fixed inset-0 z-50';
          grid.innerHTML = '<div class="w-full h-full grid grid-cols-12 grid-rows-12 gap-0 opacity-30">'+Array(144).fill('<div class="border border-purple-400"></div>').join('')+'</div>';
          document.body.appendChild(grid);
        }
        grid.style.display = '';
      } else if(grid) { grid.style.display = 'none'; }
      // Show static banner if params.banner is set
      const staticBanner = document.getElementById('static-banner');
      if(params.banner && staticBanner){
        staticBanner.style.display = '';
      }else if(staticBanner){
        staticBanner.style.display = 'none';
      }
      // Show Cookie Banner
      if(params.cookie) showCookieBanner(); else hideCookieBanner();
      // Show Popup
      if(params.popup) showPopup(); else hidePopup();
      // Show Toast
      if(params.toast) showToast();
      // Show Floating Box
      if(params.floatingBox) {
        if(!floatBox) {
          floatBox = document.createElement('div');
          floatBox.id = 'floating-box';
          floatBox.className = 'fixed top-20 right-20 bg-purple-100 border-2 border-purple-400 rounded-xl shadow-lg px-6 py-4 z-50 animate-bounce';
          floatBox.innerHTML = '<b>Floating Box</b><br>This is a floating box.';
          document.body.appendChild(floatBox);
        }
        floatBox.style.display = '';
      } else if(floatBox) { floatBox.style.display = 'none'; }
      // Extra Padding
      card && (params.extraPadding ? card.classList.add('p-12') : card.classList.remove('p-12'));
      // In applyVisualParams, update Offset Vertical and Extra Padding logic:
      const mainCard = document.getElementById('main-card');
      const mainCardParent = mainCard && mainCard.parentElement;
      if(params.offsetVertical && mainCardParent) {
        mainCardParent.style.marginTop = '32px';
      } else if(mainCardParent) {
        mainCardParent.style.marginTop = '';
      }
      // Extra Padding for all cells
      if(params.extraPadding && mainCard) {
        mainCard.querySelectorAll(':scope > div').forEach(child => child.classList.add('p-12'));
      } else if(mainCard) {
        mainCard.querySelectorAll(':scope > div').forEach(child => child.classList.remove('p-12'));
      }
      // Animate SSO buttons and header-btn-group
      const ssoBtns = document.querySelectorAll('.grid.grid-cols-3 button');
      const headerBtnGroup = document.getElementById('header-btn-group');
      if(params.anim){
        ssoBtns.forEach(btn => btn.classList.add('animate-bounce'));
        headerBtnGroup && headerBtnGroup.classList.add('animate-pulse');
      }else{
        ssoBtns.forEach(btn => btn.classList.remove('animate-bounce'));
        headerBtnGroup && headerBtnGroup.classList.remove('animate-pulse');
      }
      // Hide Form
      const loginForm = document.getElementById('login-form');
      if(params.hideForm && loginForm) {
        loginForm.style.display = 'none';
      } else if(loginForm) {
        loginForm.style.display = '';
      }
      // Alternate Button Style
      const loginBtn = document.getElementById('login-btn');
      if(params.buttonStyle && loginBtn) {
        loginBtn.classList.add('bg-pink-500','hover:bg-pink-600','border-2','border-pink-700','shadow-lg');
        loginBtn.classList.remove('bg-purple-500','hover:bg-purple-600');
      } else if(loginBtn) {
        loginBtn.classList.remove('bg-pink-500','hover:bg-pink-600','border-2','border-pink-700','shadow-lg');
        loginBtn.classList.add('bg-purple-500','hover:bg-purple-600');
      }
      // Hide One Social Button (hide Twitter)
      const ssoBtnsAll = document.querySelectorAll('.grid.grid-cols-3 button');
      if(params.hideSocial && ssoBtnsAll.length > 0) {
        ssoBtnsAll[ssoBtnsAll.length-1].style.display = 'none';
      } else if(ssoBtnsAll.length > 0) {
        ssoBtnsAll.forEach(btn => btn.style.display = '');
      }
      // Show Countdown
      const countdownDiv = document.getElementById('countdown-timer');
      if(params.timer && countdownDiv) {
        countdownDiv.classList.remove('hidden');
        let seconds = 10;
        countdownDiv.innerText = `Countdown: ${seconds}s`;
        if(window.countdownInterval) clearInterval(window.countdownInterval);
        window.countdownInterval = setInterval(() => {
          seconds--;
          if(seconds <= 0) {
            countdownDiv.innerText = 'Time is up!';
            clearInterval(window.countdownInterval);
          } else {
            countdownDiv.innerText = `Countdown: ${seconds}s`;
          }
        }, 1000);
      } else if(countdownDiv) {
        countdownDiv.classList.add('hidden');
        countdownDiv.innerText = '';
        if(window.countdownInterval) clearInterval(window.countdownInterval);
      }
      // Show Input Error
      const emailInput = document.getElementById('email');
      if(params.inputError && emailInput) {
        emailInput.classList.add('border-red-500');
        let error = document.getElementById('email-error');
        if(!error) {
          error = document.createElement('div');
          error.id = 'email-error';
          error.className = 'text-red-500 text-xs mt-1';
          error.innerText = 'Invalid email address.';
          emailInput.parentElement.appendChild(error);
        }
      } else if(emailInput) {
        emailInput.classList.remove('border-red-500');
        const error = document.getElementById('email-error');
        if(error) error.remove();
      }
      // Hide Footer
      const pageFooter = document.querySelector('footer');
      if(params.hideFooter && pageFooter) {
        pageFooter.style.display = 'none';
      } else if(pageFooter) {
        pageFooter.style.display = '';
      }
      // --- Image Effects ---
      const sliderImg = document.getElementById('slider-img');
      // Reset all effects
      if(sliderImg) {
        sliderImg.style.filter = '';
        sliderImg.style.display = '';
        sliderImg.style.opacity = '';
        sliderImg.src = 'https://images.unsplash.com/photo-1513258496099-48168024aec0?auto=format&fit=crop&w=540&q=80';
        sliderImg.classList.remove('high-contrast-img','distorted-img');
        const overlay = document.getElementById('img-overlay');
        if(overlay) overlay.remove();
      }
      // Blur
      if(params.blur && sliderImg) sliderImg.style.filter += ' blur(6px)';
      // Grayscale
      if(params.grayscale && sliderImg) sliderImg.style.filter += ' grayscale(1)';
      // High Contrast
      if(params.highContrast && sliderImg) {
        sliderImg.classList.add('high-contrast-img');
        // fallback for browsers: also add filter
        sliderImg.style.filter += ' contrast(2) brightness(1.2)';
      }
      // Overlay
      if(params.overlay && sliderImg) {
        let overlay = document.getElementById('img-overlay');
        if(!overlay) {
          overlay = document.createElement('div');
          overlay.id = 'img-overlay';
          overlay.className = 'absolute inset-0 bg-black bg-opacity-40 pointer-events-none rounded-r-3xl';
          sliderImg.parentElement.appendChild(overlay);
        }
      }
      // Hide Image
      if(params.hideImage && sliderImg) sliderImg.style.display = 'none';
      // Enable Image Slider
      if(typeof showSlider === 'function') showSlider(params.slider === 'on');
      // Simulate Broken Image
      if(params.brokenImage && sliderImg) sliderImg.src = 'broken-link.jpg';
      // Random Pixel (add one 9x9 pixel at random location)
      if(params.randomPixel && sliderImg) {
        let canvas = document.getElementById('img-noise');
        if(!canvas) {
          canvas = document.createElement('canvas');
          canvas.id = 'img-noise';
          canvas.width = sliderImg.width || 540;
          canvas.height = sliderImg.height || 320;
          canvas.className = 'absolute inset-0 pointer-events-none rounded-r-3xl';
          sliderImg.parentElement.appendChild(canvas);
        }
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0,0,canvas.width,canvas.height);
        const x = Math.floor(Math.random() * (canvas.width - 9));
        const y = Math.floor(Math.random() * (canvas.height - 9));
        const color = `rgba(${Math.floor(Math.random()*256)},${Math.floor(Math.random()*256)},${Math.floor(Math.random()*256)},1)`;
        ctx.fillStyle = color;
        ctx.fillRect(x, y, 9, 9);
      } else {
        const canvas = document.getElementById('img-noise');
        if(canvas) canvas.remove();
      }
      // Distorted Image (stretched horizontally)
      if(params.distortedImage && sliderImg) {
        sliderImg.classList.add('distorted-img');
        sliderImg.style.transform = 'scaleX(1.35)';
      } else if(sliderImg) {
        sliderImg.style.transform = '';
        sliderImg.classList.remove('distorted-img');
      }
    }
    paramReset.onclick = () => {
      const defaults = getDefaultParams();
      const params = new URLSearchParams();
      Object.entries(defaults).forEach(([k,v])=>params.set(k,v));
      window.history.replaceState({}, '', `${window.location.pathname}?${params}`);
      applyVisualParams();
      renderParamTabs(0);
      renderParamForm(0);
      // Reset font/text styles
      document.body.classList.remove('font-serif','font-sans','font-mono','font-roboto','text-lg','text-base','text-sm','font-bold');
      document.body.style.color = '';
      document.body.style.fontFamily = '';
      const subtitle = document.getElementById('login-subtitle');
      if(subtitle) subtitle.innerText = 'Welcome back! Please enter your details';
    };
    helpIcon.onclick = () => {
      helpPanel.classList.remove('side-panel-closed');
      helpPanel.classList.add('side-panel-open');
      helpPanel.style.right = '0';
      renderParamTabs(activeParamTab);
      renderParamForm(activeParamTab);
      showOverlay();
    };
    helpClose.onclick = () => {
      helpPanel.classList.remove('side-panel-open');
      helpPanel.classList.add('side-panel-closed');
      helpPanel.style.right = '-400px';
      hideOverlay();
    };
    helpPanel.classList.add('side-panel-closed');
    // Initial render
    renderParamTabs(activeParamTab);
    renderParamForm(activeParamTab);
    // Apply URL params on load
    applyVisualParams();

    // --- Login/Signup/Forgot Logic (unchanged, but inside DOMContentLoaded) ---
    // ... existing code ...

    // Overlay click closes whichever panel is open
    overlay.onclick = function() {
      if (!sidePanel.classList.contains('side-panel-closed')) {
        sidePanel.classList.remove('side-panel-open');
        sidePanel.classList.add('side-panel-closed');
        sidePanel.style.left = '-400px';
      }
      if (!helpPanel.classList.contains('side-panel-closed')) {
        helpPanel.classList.remove('side-panel-open');
        helpPanel.classList.add('side-panel-closed');
        helpPanel.style.right = '-400px';
      }
      hideOverlay();
    };

    // Language switcher
    const langIcon = document.getElementById('lang-icon');
    const langModal = document.getElementById('lang-modal');
    const langModalClose = document.getElementById('lang-modal-close');
    const langSelect = document.getElementById('lang-select');
    const langApply = document.getElementById('lang-apply');
    langIcon && (langIcon.onclick = function() {
      langModal.classList.remove('hidden');
      // Set current lang in select
      const params = new URLSearchParams(window.location.search);
      const current = params.get('lang') || 'en';
      langSelect.value = current;
    });
    langModalClose && (langModalClose.onclick = function() {
      langModal.classList.add('hidden');
    });
    langApply && (langApply.onclick = function() {
      const params = new URLSearchParams(window.location.search);
      params.set('lang', langSelect.value);
      window.history.replaceState({}, '', `${window.location.pathname}?${params}`);
      setLanguageUI(langSelect.value);
      updateHeaderBtnGroupAlignment();
      langModal.classList.add('hidden'); // Dismiss the language modal
    });

    // --- Language translations ---
    const translations = {
      en: {
        login: 'Log In',
        subheading: 'Welcome back! Please enter your details',
        forgot: 'forgot password?',
        loginBtn: 'Log in',
        signupBtn: 'Sign Up',
        signupLink: "Don't have account?",
        signup: 'Sign Up',
        backToLogin: 'Back to Login',
        sendReset: 'Send Reset Link',
        name: 'Name',
        email: 'Email',
        password: 'Password',
        confirm: 'Confirm Password',
        info: 'Info',
        settings: 'Settings',
        language: 'Your language',
        apply: 'Apply',
      },
      nl: {
        login: 'Inloggen', subheading: 'Welkom terug! Vul uw gegevens in', forgot: 'wachtwoord vergeten?', loginBtn: 'Inloggen', signupBtn: 'Registreren', signupLink: 'Nog geen account?', signup: 'Registreren', backToLogin: 'Terug naar inloggen', sendReset: 'Stuur resetlink', name: 'Naam', email: 'E-mail', password: 'Wachtwoord', confirm: 'Bevestig wachtwoord', info: 'Info', settings: 'Instellingen', language: 'Uw taal', apply: 'Toepassen',
      },
      fr: {
        login: 'Connexion', subheading: 'Bon retour! Veuillez entrer vos informations', forgot: 'mot de passe oublié ?', loginBtn: 'Connexion', signupBtn: 'S\'inscrire', signupLink: 'Pas de compte ?', signup: 'S\'inscrire', backToLogin: 'Retour à la connexion', sendReset: 'Envoyer le lien', name: 'Nom', email: 'E-mail', password: 'Mot de passe', confirm: 'Confirmez le mot de passe', info: 'Info', settings: 'Paramètres', language: 'Votre langue', apply: 'Appliquer',
      },
      de: {
        login: 'Anmelden', subheading: 'Willkommen zurück! Bitte geben Sie Ihre Daten ein', forgot: 'Passwort vergessen?', loginBtn: 'Anmelden', signupBtn: 'Registrieren', signupLink: 'Noch kein Konto?', signup: 'Registrieren', backToLogin: 'Zurück zum Login', sendReset: 'Link senden', name: 'Name', email: 'E-Mail', password: 'Passwort', confirm: 'Passwort bestätigen', info: 'Info', settings: 'Einstellungen', language: 'Ihre Sprache', apply: 'Anwenden',
      },
      it: {
        login: 'Accedi', subheading: 'Bentornato! Inserisci i tuoi dati', forgot: 'password dimenticata?', loginBtn: 'Accedi', signupBtn: 'Registrati', signupLink: 'Non hai un account?', signup: 'Registrati', backToLogin: 'Torna al login', sendReset: 'Invia link', name: 'Nome', email: 'Email', password: 'Password', confirm: 'Conferma password', info: 'Info', settings: 'Impostazioni', language: 'La tua lingua', apply: 'Applica',
      },
      es: {
        login: 'Iniciar sesión', subheading: '¡Bienvenido! Por favor ingresa tus datos', forgot: '¿olvidaste tu contraseña?', loginBtn: 'Iniciar sesión', signupBtn: 'Registrarse', signupLink: '¿No tienes cuenta?', signup: 'Registrarse', backToLogin: 'Volver al inicio', sendReset: 'Enviar enlace', name: 'Nombre', email: 'Correo electrónico', password: 'Contraseña', confirm: 'Confirmar contraseña', info: 'Info', settings: 'Configuración', language: 'Tu idioma', apply: 'Aplicar',
      },
      hi: {
        login: 'लॉग इन', subheading: 'वापस स्वागत है! कृपया अपनी जानकारी दर्ज करें', forgot: 'पासवर्ड भूल गए?', loginBtn: 'लॉग इन', signupBtn: 'साइन अप', signupLink: 'कोई खाता नहीं?', signup: 'साइन अप', backToLogin: 'लॉगिन पर वापस जाएं', sendReset: 'रीसेट लिंक भेजें', name: 'नाम', email: 'ईमेल', password: 'पासवर्ड', confirm: 'पासवर्ड की पुष्टि करें', info: 'जानकारी', settings: 'सेटिंग्स', language: 'आपकी भाषा', apply: 'लागू करें',
      },
      bn: {
        login: 'লগইন', subheading: 'ফিরে আসার জন্য স্বাগতম! আপনার তথ্য দিন', forgot: 'পাসওয়ার্ড ভুলে গেছেন?', loginBtn: 'লগইন', signupBtn: 'সাইন আপ', signupLink: 'কোনো অ্যাকাউন্ট নেই?', signup: 'সাইন আপ', backToLogin: 'লগইনে ফিরে যান', sendReset: 'রিসেট লিঙ্ক পাঠান', name: 'নাম', email: 'ইমেল', password: 'পাসওয়ার্ড', confirm: 'পাসওয়ার্ড নিশ্চিত করুন', info: 'তথ্য', settings: 'সেটিংস', language: 'আপনার ভাষা', apply: 'প্রয়োগ করুন',
      },
      te: {
        login: 'లాగిన్', subheading: 'మళ్లీ స్వాగతం! దయచేసి మీ వివరాలు నమోదు చేయండి', forgot: 'పాస్వర్డ్ మర్చిపోయారా?', loginBtn: 'లాగిన్', signupBtn: 'సైన్ అప్', signupLink: 'ఖాతా లేదు?', signup: 'సైన్ అప్', backToLogin: 'లాగిన్‌కు తిరిగి వెళ్లండి', sendReset: 'రిసెట్ లింక్ పంపండి', name: 'పేరు', email: 'ఇమെయిల్', password: 'పాస్వర్డ్', confirm: 'పాస్వర్డ్ నిర్ధారించండి', info: 'సమాచారం', settings: 'సెట్టింగ్స్', language: 'మీ భాష', apply: 'వర్తించు',
      },
      mr: {
        login: 'लॉगिन', subheading: 'पुन्हा स्वागत आहे! कृपया आपली माहिती प्रविष्ट करा', forgot: 'पासवर्ड विसरलात?', loginBtn: 'लॉगिन', signupBtn: 'साइन अप', signupLink: 'खाते नाही?', signup: 'साइन अप', backToLogin: 'लॉगिनवर परत जा', sendReset: 'रीसेट लिंक पाठवा', name: 'नाव', email: 'ईमेल', password: 'पासवर्ड', confirm: 'पासवर्डची पुष्टी करा', info: 'माहिती', settings: 'सेटिंग्ज', language: 'आपली भाषा', apply: 'लागू करा',
      },
      ml: {
        login: 'ലോഗിൻ', subheading: 'തിരികെ സ്വാഗതം! ദയവായി നിങ്ങളുടെ വിവരങ്ങൾ നൽകുക', forgot: 'പാസ്‌വേഡ് മറന്നോ?', loginBtn: 'ലോഗിൻ', signupBtn: 'സൈൻ അപ്പ്', signupLink: 'അക്കൗണ്ട് ഇല്ലേ?', signup: 'സൈൻ അപ്പ്', backToLogin: 'ലോഗിനിലേക്ക് മടങ്ങുക', sendReset: 'റീസെറ്റ് ലിങ്ക് അയയ്ക്കുക', name: 'പേര്', email: 'ഇമെയിൽ', password: 'പാസ്‌വേഡ്', confirm: 'പാസ്‌വേഡ് സ്ഥിരീകരിക്കുക', info: 'വിവരം', settings: 'ക്രമീകരണങ്ങൾ', language: 'നിങ്ങളുടെ ഭാഷ', apply: 'പ്രയോഗിക്കുക',
      },
      ar: {
        login: 'تسجيل الدخول', subheading: 'مرحبًا بعودتك! الرجاء إدخال بياناتك', forgot: 'هل نسيت كلمة المرور؟', loginBtn: 'تسجيل الدخول', signupBtn: 'إنشاء حساب', signupLink: 'ليس لديك حساب؟', signup: 'إنشاء حساب', backToLogin: 'العودة لتسجيل الدخول', sendReset: 'إرسال رابط إعادة التعيين', name: 'الاسم', email: 'البريد الإلكتروني', password: 'كلمة المرور', confirm: 'تأكيد كلمة المرور', info: 'معلومات', settings: 'الإعدادات', language: 'لغتك', apply: 'تطبيق',
      },
    };
    function setLanguageUI(lang) {
      const t = translations[lang] || translations.en;
      document.getElementById('login-heading').innerText = t.login;
      document.getElementById('login-subtitle').innerText = t.subheading;
      const forgot = document.getElementById('forgot-link');
      if(forgot) forgot.innerText = t.forgot;
      const loginBtn = document.getElementById('login-btn');
      if(loginBtn) loginBtn.innerText = t.loginBtn;
      const signupBtn = document.getElementById('signup-btn');
      if(signupBtn) signupBtn.innerText = t.signupBtn;
      const signupLink = document.getElementById('signup-link-row');
      if(signupLink) signupLink.innerHTML = `${t.signupLink}<a href="#" class="text-purple-500 ml-1" id="show-signup">${t.signup}</a>`;
      const backToLogin = document.getElementById('back-to-login');
      if(backToLogin) backToLogin.innerText = t.backToLogin;
      const backToLoginSignup = document.getElementById('back-to-login-signup');
      if(backToLoginSignup) backToLoginSignup.innerText = t.backToLogin;
      const sendReset = document.querySelector('#forgot-fields button[type="submit"]');
      if(sendReset) sendReset.innerText = t.sendReset;
      const nameLabel = document.querySelector('label[for="signup-name"]');
      if(nameLabel) nameLabel.innerText = t.name;
      const emailLabel = document.querySelector('label[for="email"]');
      if(emailLabel) emailLabel.innerText = t.email;
      const signupEmailLabel = document.querySelector('label[for="signup-email"]');
      if(signupEmailLabel) signupEmailLabel.innerText = t.email;
      const forgotEmailLabel = document.querySelector('label[for="forgot-email"]');
      if(forgotEmailLabel) forgotEmailLabel.innerText = t.email;
      const passwordLabel = document.querySelector('label[for="password"]');
      if(passwordLabel) passwordLabel.innerText = t.password;
      const signupPasswordLabel = document.querySelector('label[for="signup-password"]');
      if(signupPasswordLabel) signupPasswordLabel.innerText = t.password;
      const signupConfirmLabel = document.querySelector('label[for="signup-confirm"]');
      if(signupConfirmLabel) signupConfirmLabel.innerText = t.confirm;
      // Info/settings/lang modals
      const infoBtn = document.getElementById('open-side-panel-btn');
      if(infoBtn) infoBtn.title = t.info;
      const helpIcon = document.getElementById('help-icon');
      if(helpIcon) helpIcon.title = t.settings;
      const langModalTitle = document.querySelector('#lang-modal .font-bold');
      if(langModalTitle) langModalTitle.innerText = t.language;
      const langApply = document.getElementById('lang-apply');
      if(langApply) langApply.innerText = t.apply;
      // Update placeholders for all fields
      const emailInput = document.getElementById('email');
      if(emailInput) emailInput.placeholder = t.email;
      const passwordInput = document.getElementById('password');
      if(passwordInput) passwordInput.placeholder = t.password;
      const signupNameInput = document.getElementById('signup-name');
      if(signupNameInput) signupNameInput.placeholder = t.name;
      const signupEmailInput = document.getElementById('signup-email');
      if(signupEmailInput) signupEmailInput.placeholder = t.email;
      const signupPasswordInput = document.getElementById('signup-password');
      if(signupPasswordInput) signupPasswordInput.placeholder = t.password;
      const signupConfirmInput = document.getElementById('signup-confirm');
      if(signupConfirmInput) signupConfirmInput.placeholder = t.confirm;
      const forgotEmailInput = document.getElementById('forgot-email');
      if(forgotEmailInput) forgotEmailInput.placeholder = t.email;
      // Set direction for RTL languages
      const rtlLangs = ['ar', 'he', 'fa', 'ur'];
      document.body.dir = rtlLangs.includes(lang) ? 'rtl' : 'ltr';
    }
    // Set language on load
    const urlParams = new URLSearchParams(window.location.search);
    const lang = urlParams.get('lang') || 'en';
    setLanguageUI(lang);

    // Orientation class on body for advanced control
    function setOrientationClass() {
      const isPortrait = window.matchMedia('(orientation: portrait)').matches;
      document.body.classList.toggle('portrait', isPortrait);
      document.body.classList.toggle('landscape', !isPortrait);
    }
    setOrientationClass();
    window.addEventListener('resize', setOrientationClass);

    // --- Login/Signup/Forgot Functionality ---
    function showLogin() {
      document.getElementById('login-fields').style.display = '';
      document.getElementById('forgot-fields').style.display = 'none';
      document.getElementById('signup-fields').style.display = 'none';
      document.getElementById('signup-link-row').style.display = '';
      document.getElementById('login-heading').innerText = translations[lang]?.login || 'Log In';
      document.getElementById('login-subtitle').innerText = translations[lang]?.subheading || 'Welcome back! Please enter your details';
      // Set required only on visible fields
      setRequiredFields(['email','password'], ['forgot-email','signup-name','signup-email','signup-password','signup-confirm']);
    }
    function showForgot() {
      document.getElementById('login-fields').style.display = 'none';
      document.getElementById('forgot-fields').style.display = '';
      document.getElementById('signup-fields').style.display = 'none';
      document.getElementById('signup-link-row').style.display = 'none';
      document.getElementById('login-heading').innerText = translations[lang]?.forgot || 'Forgot Password';
      document.getElementById('login-subtitle').innerText = '';
      setRequiredFields(['forgot-email'], ['email','password','signup-name','signup-email','signup-password','signup-confirm']);
    }
    function showSignup() {
      document.getElementById('login-fields').style.display = 'none';
      document.getElementById('forgot-fields').style.display = 'none';
      document.getElementById('signup-fields').style.display = '';
      document.getElementById('signup-link-row').style.display = 'none';
      document.getElementById('login-heading').innerText = translations[lang]?.signup || 'Sign Up';
      document.getElementById('login-subtitle').innerText = '';
      setRequiredFields(['signup-name','signup-email','signup-password','signup-confirm'], ['email','password','forgot-email']);
    }
    // Helper to set required only on visible fields
    function setRequiredFields(requiredIds, notRequiredIds) {
      requiredIds.forEach(id => { const el = document.getElementById(id); if(el) el.setAttribute('required','required'); });
      notRequiredIds.forEach(id => { const el = document.getElementById(id); if(el) el.removeAttribute('required'); });
    }
    document.getElementById('forgot-link').onclick = function(e) { e.preventDefault(); showForgot(); };
    document.getElementById('back-to-login').onclick = function(e) { e.preventDefault(); showLogin(); };
    document.getElementById('show-signup').onclick = function(e) { e.preventDefault(); showSignup(); };
    document.getElementById('back-to-login-signup').onclick = function(e) { e.preventDefault(); showLogin(); };

    // --- Social Media Login Popup ---
    function showSocialPopup(type) {
      if(document.getElementById('social-popup')) return;
      const providers = {
        google: { name: 'Google', color: 'bg-white text-gray-900', icon: 'fab fa-google', btn: 'bg-red-500 text-white', brand: '#EA4335', logo: 'https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg' },
        facebook: { name: 'Facebook', color: 'bg-white text-gray-900', icon: 'fab fa-facebook-f', btn: 'bg-blue-600 text-white', brand: '#1877F3', logo: 'https://upload.wikimedia.org/wikipedia/commons/0/05/Facebook_Logo_%282019%29.png' },
        apple: { name: 'Apple', color: 'bg-white text-gray-900', icon: 'fab fa-apple', btn: 'bg-black text-white', brand: '#000', logo: 'https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg' },
        linkedin: { name: 'LinkedIn', color: 'bg-white text-gray-900', icon: 'fab fa-linkedin-in', btn: 'bg-blue-700 text-white', brand: '#0077B5', logo: 'https://upload.wikimedia.org/wikipedia/commons/c/ca/LinkedIn_logo_initials.png' },
        microsoft: { name: 'Microsoft', color: 'bg-white text-gray-900', icon: 'fab fa-microsoft', btn: 'bg-blue-800 text-white', brand: '#0078D4', logo: 'https://upload.wikimedia.org/wikipedia/commons/4/44/Microsoft_logo.svg' },
        twitter: { name: 'Twitter', color: 'bg-white text-gray-900', icon: 'fab fa-twitter', btn: 'bg-sky-400 text-white', brand: '#1DA1F2', logo: 'https://upload.wikimedia.org/wikipedia/commons/4/4f/Twitter-logo.svg' }
      };
      const p = providers[type] || providers.google;
      const user = { avatar: 'https://randomuser.me/api/portraits/men/32.jpg', name: 'John Doe', email: 'john.doe@email.com' };
      const popup = document.createElement('div');
      popup.id = 'social-popup';
      popup.className = 'fixed inset-0 flex items-center justify-center z-[4000] bg-black bg-opacity-40';
      popup.innerHTML = `
        <div class="bg-white rounded-2xl shadow-2xl w-[92vw] max-w-[340px] text-center relative flex flex-col items-center border border-gray-200 p-6">
          <button id="social-popup-close" class="absolute top-3 right-4 text-2xl text-purple-500 hover:text-purple-700 transition">&times;</button>
          <div class="text-2xl font-bold mb-2 flex items-center gap-2 justify-center" style="color:${p.brand}"><i class="${p.icon}"></i> ${p.name} Sign In</div>
          <div class="flex flex-col items-center mb-4">
            <img src="${user.avatar}" alt="User avatar" class="w-14 h-14 rounded-full border mb-1 shadow">
            <div class="font-semibold text-base">${user.name}</div>
            <div class="text-xs text-gray-500">${user.email}</div>
          </div>
          <div class="mb-4 text-gray-600 text-sm text-left w-full">
            <b>${p.name}</b> will share your name, email address, and profile picture with <b>Visual Regression - Evaluator</b>.<br>
            <span class="text-xs text-gray-400">You can review and remove access at any time in your ${p.name} account settings.</span>
          </div>
          <div class="flex gap-2 w-full mt-2">
            <button class="flex-1 rounded-lg px-4 py-2 font-semibold shadow hover:opacity-90 transition" style="background:${p.brand};color:#fff;">Continue as ${user.name.split(' ')[0]}</button>
            <button class="flex-1 bg-gray-100 text-gray-700 rounded-lg px-4 py-2 font-semibold shadow hover:bg-gray-200 transition">Cancel</button>
          </div>
        </div>
      `;
      document.body.appendChild(popup);
      popup.querySelector('#social-popup-close').onclick = function() { popup.remove(); };
      popup.querySelector('.bg-gray-100').onclick = function() { popup.remove(); };
      popup.querySelector('.'+p.btn.replace(/ /g,'.')).onclick = function() { popup.remove(); };
    }
    // Attach to all social buttons
    document.querySelectorAll('button').forEach(btn => {
      if(btn.innerHTML.includes('Google')) btn.onclick = function(e){ e.preventDefault(); showSocialPopup('google'); };
      if(btn.innerHTML.includes('Facebook')) btn.onclick = function(e){ e.preventDefault(); showSocialPopup('facebook'); };
      if(btn.innerHTML.includes('Apple')) btn.onclick = function(e){ e.preventDefault(); showSocialPopup('apple'); };
      if(btn.innerHTML.includes('LinkedIn')) btn.onclick = function(e){ e.preventDefault(); showSocialPopup('linkedin'); };
      if(btn.innerHTML.includes('Microsoft')) btn.onclick = function(e){ e.preventDefault(); showSocialPopup('microsoft'); };
      if(btn.innerHTML.includes('Twitter')) btn.onclick = function(e){ e.preventDefault(); showSocialPopup('twitter'); };
    });

    // After setLanguageUI(lang) in JS, add:
    function updateHeaderBtnGroupAlignment() {
      const group = document.getElementById('header-btn-group');
      if (!group) return;
      if (document.body.dir === 'rtl') {
        group.classList.remove('justify-end');
        group.classList.add('justify-start');
      } else {
        group.classList.remove('justify-start');
        group.classList.add('justify-end');
      }
    }
    // Call updateHeaderBtnGroupAlignment() after setLanguageUI(lang)
    setLanguageUI(lang);
    updateHeaderBtnGroupAlignment();
    // Also call updateHeaderBtnGroupAlignment() inside setLanguageUI(lang) after setting dir

    // Fix 'Don't have account? Sign Up' link to always be clickable
    // In setLanguageUI and after rendering, always re-attach the event listener to #show-signup
    function attachSignupLinkHandler() {
      const signupLink = document.getElementById('show-signup');
      if(signupLink) {
        signupLink.onclick = function(e) { e.preventDefault(); showSignup(); };
      }
    }
    attachSignupLinkHandler();
    // Also call attachSignupLinkHandler() in setLanguageUI after updating innerHTML

    // Forgot password OTP flow
    // In the forgot-fields form, after clicking 'Send Reset Link', replace the form with 6 OTP input boxes, a submit button, and a 'Didn't receive code? Resend code' link
    // On OTP submit, show the login form again
    const forgotForm = document.querySelector('#forgot-fields form, #forgot-fields');
    if(forgotForm) {
      forgotForm.onsubmit = function(e) {
        e.preventDefault();
        // Show OTP input UI
        const forgotFields = document.getElementById('forgot-fields');
        forgotFields.innerHTML = `
          <div class="mb-2 text-center font-semibold">Enter the 6-digit code sent to your email</div>
          <form id="otp-form" class="flex flex-col items-center gap-3">
            <div class="flex gap-2 justify-center mb-2">
              <input type="text" maxlength="1" class="otp-input w-10 h-12 text-2xl text-center border rounded" required>
              <input type="text" maxlength="1" class="otp-input w-10 h-12 text-2xl text-center border rounded" required>
              <input type="text" maxlength="1" class="otp-input w-10 h-12 text-2xl text-center border rounded" required>
              <input type="text" maxlength="1" class="otp-input w-10 h-12 text-2xl text-center border rounded" required>
              <input type="text" maxlength="1" class="otp-input w-10 h-12 text-2xl text-center border rounded" required>
              <input type="text" maxlength="1" class="otp-input w-10 h-12 text-2xl text-center border rounded" required>
            </div>
            <button type="submit" class="w-full py-2 bg-purple-500 text-white rounded-md font-semibold hover:bg-purple-600 transition mb-2">Submit</button>
            <div class="text-sm text-gray-500 mt-2">Didn't receive code? <a href="#" id="resend-otp" class="text-purple-500 underline">Resend code</a></div>
          </form>
        `;
        // OTP input auto-focus
        const otpInputs = forgotFields.querySelectorAll('.otp-input');
        otpInputs.forEach((input, idx) => {
          input.addEventListener('input', function() {
            if(this.value.length === 1 && idx < otpInputs.length - 1) {
              otpInputs[idx+1].focus();
            }
          });
          input.addEventListener('keydown', function(e) {
            if(e.key === 'Backspace' && !this.value && idx > 0) {
              otpInputs[idx-1].focus();
            }
          });
        });
        // OTP form submit
        forgotFields.querySelector('#otp-form').onsubmit = function(e) {
          e.preventDefault();
          showLogin();
        };
        // Resend code
        forgotFields.querySelector('#resend-otp').onclick = function(e) {
          e.preventDefault();
          // Optionally show a message or re-run the OTP UI
          // For now, just clear the OTP inputs
          otpInputs.forEach(input => input.value = '');
          otpInputs[0].focus();
        };
      };
    }
    // ... existing code ...
    // In setLanguageUI, after updating innerHTML for signup link, call attachSignupLinkHandler();
  });
})();
  </script>
</body>
</html>
